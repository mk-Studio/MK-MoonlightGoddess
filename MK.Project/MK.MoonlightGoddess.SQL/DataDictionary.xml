<?xml version="1.0" encoding="utf-8" ?>
<DataDictionary>

  <sql name="QueryInfoWuLiao">
    SELECT TOP (@limit)
    ID,WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,WuLiaoImagePath,ShowMark,CreateUser,CreateDate INTO #TableResult
    FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY wlinfo.CreateDate DESC ) AS RowID,
    wlinfo.ID,wltype.WuLiaoTypeName AS WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,WuLiaoImagePath,wlinfo.ShowMark,wlinfo.CreateUser,wlinfo.CreateDate
    FROM MK_Info_WuLiao wlinfo JOIN dbo.MK_Type_WuLiao wltype ON wltype.ID = wlinfo.WuLiaoTypeID
    WHERE WuLiaoTypeID = ISNULL(@WuLiaoTypeID,WuLiaoTypeID)
    AND ShangPinName = ISNULL(@ShangPinName,ShangPinName)
    AND GuiGe = ISNULL(@GuiGe,GuiGe)
    AND HaiGuanNo = ISNULL(@HaiGuanNo,HaiGuanNo)
    AND wlinfo.ShowMark = ISNULL(@ShowMark,wlinfo.ShowMark)
    AND wlinfo.CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    ORDER BY t.RowID

    SELECT * FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>
  
  <sql name="QueryTypeWuLiao">
    SELECT TOP (@limit)
    ID,WuLiaoTypeName,ShowMark,CreateUser,CreateDate
    INTO #TableResult
    FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY CreateDate DESC ) AS RowID,* FROM MK_Type_WuLiao
    WHERE WuLiaoTypeName = ISNULL(@WuLiaoTypeName,WuLiaoTypeName)
    AND ShowMark = ISNULL(@ShowMark,ShowMark)
    AND CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    order by t.RowID

    SELECT ID,WuLiaoTypeName,ShowMark,CreateUser, CreateDate FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>
  
  <sql name="QueryInfoSupplier">
    SELECT TOP (@limit)
    ID,SupplierName,LianXiRen,LianXiFangShi,Address,ShowMark,CreateUser,CreateDate,t.WuLiaoDetail
    INTO #TableResult
    FROM (
          SELECT ROW_NUMBER() OVER (ORDER BY a.CreateDate DESC ) AS RowID,a.*,(
              SELECT '['+twl.WuLiaoTypeName+']'
              FROM dbo.MK_Info_Supplier_WuLiao swl
              JOIN dbo.MK_Type_WuLiao twl ON twl.ID = swl.ShangPinID
              WHERE swl.SupplierID = a.ID
              FOR XML PATH('')
      ) AS WuLiaoDetail
      FROM dbo.MK_Info_Supplier a
      JOIN dbo.MK_Info_Supplier_WuLiao b ON b.SupplierID = a.ID
      WHERE SupplierName = ISNULL(@SupplierName,SupplierName)
      AND LianXiRen = ISNULL(@LianXiRen,LianXiRen)
      AND LianXiFangShi = ISNULL(@LianXiFangShi,LianXiFangShi)
      AND Address = ISNULL(@Address,Address)
      AND a.ShowMark = ISNULL(@ShowMark,a.ShowMark)
      AND b.ShangPinID #SQL#
      AND a.CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
      GROUP BY a.ID,SupplierName, [LianXiRen], [LianXiFangShi], [Address], a.[ShowMark], a.[CreateUser], a.[CreateDate]
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    ORDER BY t.RowID

    SELECT * FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>

  <sql name="QueryTypeWuLiuYeWu">
    SELECT TOP (@limit)
    ID,YeWuType,ShowMark,CreateUser,CreateDate INTO #TableResult
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY CreateDate DESC ) AS RowID,
        ID,YeWuType,ShowMark,CreateUser,CreateDate
        FROM MK_Type_WuLiuYeWu
        WHERE YeWuType = ISNULL(@YeWuType,YeWuType)
        AND ShowMark = ISNULL(@ShowMark,ShowMark)
        AND CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    ORDER BY t.RowID

    SELECT * FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>

  <sql name="QueryInfoWuLiuCompany">
    SELECT TOP (@limit)
    ID,YeWuID,YeWuName,Name,LianXiRen,LianXiFangShi,Address,ShowMark,CreateUser,CreateDate INTO #TableResult
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY wlc.CreateDate DESC ) AS RowID,
        wlc.ID,YeWuID,wlt.YeWuType AS YeWuName,Name,LianXiRen,LianXiFangShi,Address,wlc.ShowMark,wlc.CreateUser,wlc.CreateDate
        FROM dbo.MK_Info_WuLiuCompany wlc JOIN dbo.MK_Type_WuLiuYeWu wlt ON wlt.ID = wlc.YeWuID
        WHERE wlc.YeWuID = ISNULL(@YeWuID,wlc.YeWuID)
        AND wlc.Name = ISNULL(@Name,wlc.Name)
        AND wlc.LianXiRen = ISNULL(@LianXiRen,wlc.LianXiRen)
        AND wlc.LianXiFangShi = ISNULL(@LianXiFangShi,wlc.LianXiFangShi)
        AND wlc.Address = ISNULL(@Address,wlc.Address)
        AND wlc.ShowMark = ISNULL(@ShowMark,wlc.ShowMark)
        AND wlc.CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    ORDER BY t.RowID
    SELECT * FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>

  <sql name="QueryInfoCurrency">
    SELECT TOP (@limit)
    ID,CurrencyName,CurrencyCode,Remark,ShowMark,CreateUser,CreateDate INTO #TableResult
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY CreateDate DESC ) AS RowID,
        ID,CurrencyName,CurrencyCode,Remark,ShowMark,CreateUser,CreateDate
        FROM MK_Info_Currency
        WHERE CurrencyName = ISNULL(@CurrencyName,CurrencyName)
        AND CurrencyCode = ISNULL(@CurrencyCode,CurrencyCode)
        AND Remark = ISNULL(@Remark,Remark)
        AND ShowMark = ISNULL(@ShowMark,ShowMark)
        AND CreateDate BETWEEN ISNULL(@StartDate,'2018-5-20') AND ISNULL(@EndDate,DATEADD(HH,1,GETDATE()))
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    ORDER BY t.RowID
    SELECT * FROM #TableResult
    SELECT COUNT(ID) AS rows FROM #TableResult
    DROP TABLE #TableResult
  </sql>

  <sql name="CheckInfoWuLiaoEXISTS">
    SELECT COUNT(ID) FROM dbo.MK_Info_WuLiao WHERE ShangPinName = @ShangPinName AND GuiGe = @GuiGe
  </sql>

  <sql name="InsertInfoWuLiao">
    INSERT MK_Info_WuLiao
    (WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,CreateUser,CreateDate)
    VALUES
    (@WuLiaoTypeID,@ShangPinName,@GuiGe,@HaiGuanNo,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertTypeWuLiao">
    INSERT MK_Type_WuLiao (WuLiaoTypeName,CreateUser,CreateDate) VALUES (@WuLiaoTypeName,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertInfoSupplier">
    INSERT MK_Info_Supplier 
    (ID,SupplierName,LianXiRen,LianXiFangShi,Address,CreateUser,CreateDate) 
    VALUES
    (@ID,@SupplierName,@LianXiRen,@LianXiFangShi,@Address,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertTypeWuLiuYeWu">
    INSERT MK_Type_WuLiuYeWu(YeWuType,CreateUser,CreateDate)
    VALUES(@YeWuType,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertInfoWuLiuCompany">
    INSERT MK_Info_WuLiuCompany(YeWuID,Name,LianXiRen,LianXiFangShi,Address,CreateUser,CreateDate)
    VALUES(@YeWuID,@Name,@LianXiRen,@LianXiFangShi,@Address,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertInfoCurrency">
    INSERT MK_Info_Currency(CurrencyName,CurrencyCode,Remark,CreateUser,CreateDate)
    VALUES(@CurrencyName,@CurrencyCode,@Remark,@CreateUser,@CreateDate)
  </sql>

  <sql name="UpdateInfoWuLiao">
    UPDATE MK_Info_WuLiao
    SET SupplierName = @SupplierName,LianXiRen=@LianXiRen,LianXiFangShi=@LianXiFangShi,Address=@Address,
    CreateUser=@CreateUser,CreateDate=@CreateDate
    WHERE ID = @ID
  </sql>

  <sql name="UpdateTypeWuLiao">
    UPDATE MK_Type_WuLiao SET WuLiaoTypeName = @WuLiaoTypeName WHERE ID = @ID
  </sql>
  
  <sql name="UpdateInfoSupplier">
    UPDATE MK_Info_Supplier
    SET SupplierName = @SupplierName,LianXiRen = @LianXiRen,LianXiFangShi = @LianXiFangShi,Address = @Address
    WHERE ID = @ID

    DELETE FROM MK_Info_Supplier_WuLiao WHERE SupplierID=@ID
  </sql>

  <sql name="UpdateTypeWuLiuYeWu">
    UPDATE MK_Type_WuLiuYeWu SET YeWuType = @YeWuType,CreateUser= @CreateUser,CreateDate= @CreateDate
    WHERE ID = @ID
  </sql>

  <sql name="UpdateInfoWuLiuCompany">
    UPDATE MK_Info_WuLiuCompany SET YeWuID = @YeWuID,Name= @Name,
    LianXiRen = @LianXiRen,LianXiFangShi= @LianXiFangShi,Address= @Address,
    CreateUser= @CreateUser,CreateDate= @CreateDate
    WHERE ID = @ID
  </sql>
  
  <sql name="UpdateInfoCurrency">
    UPDATE dbo.MK_Info_Currency SET 
    CurrencyName=@CurrencyName,CurrencyCode=@CurrencyCode,Remark=@Remark,CreateUser=@CreateUser,CreateDate=@CreateDate
    WHERE ID = @ID
  </sql>

  <sql name="DeleteInfoWuLiao">
    DELETE FROM MK_Info_WuLiao WHERE ID = @ID
  </sql>

  <sql name="DeleteTypeWuLiao">
    DELETE FROM MK_Type_WuLiao WHERE ID = @ID
  </sql>
  
  <sql name="DeleteInfoSupplier">
    DELETE FROM MK_Info_Supplier WHERE ID=@ID
    DELETE FROM MK_Info_Supplier_WuLiao WHERE SupplierID=@ID
  </sql>

  <sql name="DeleteTypeWuLiuYeWu">
    DELETE FROM MK_Type_WuLiuYeWu WHERE ID = @ID
  </sql>

  <sql name="DeleteInfoWuLiuCompany">
    DELETE FROM MK_Info_WuLiuCompany WHERE ID = @ID
  </sql>
  
  <sql name="DeleteInfoCurrency">
    DELETE FROM MK_Info_Currency WHERE ID = @ID
  </sql>

  <sql name="GetWuLiaoTypeID">
    SELECT WuLiaoTypeID FROM MK_Info_WuLiao WHERE ID = @ID
  </sql>

  <sql name="GetShangPinBySupplier">
    SELECT ShangPinID FROM MK_Info_Supplier_WuLiao WHERE SupplierID = @SupplierID
  </sql>

  <sql name="SaveWuLiaoImagePath">
    UPDATE MK_Info_WuLiao SET WuLiaoImagePath = @WuLiaoImagePath WHERE ID = @ID
  </sql>

  <sql name="UpdateTypeWuLiaoShowMark">
    UPDATE MK_Type_WuLiao SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

  <sql name="UpdateInfoWuLiaoShowMark">
    UPDATE MK_Info_WuLiao SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

  <sql name="UpdateInfoSupplierShowMark">
    UPDATE MK_Info_Supplier SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

  <sql name="UpdateTypeWuLiuYeWuShowMark">
    UPDATE MK_Type_WuLiuYeWu SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

  <sql name="UpdateInfoWuLiuCompanyShowMark">
    UPDATE MK_Info_WuLiuCompany SET SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

  <sql name="UpdateInfoCurrencyShowMark">
    UPDATE MK_Info_Currency SET SET ShowMark = @ShowMark WHERE ID = @ID
  </sql>

</DataDictionary>