<?xml version="1.0" encoding="utf-8" ?>
<DataDictionary>

  <sql name="QueryInfoWuLiao">
    SELECT TOP (@limit)
    ID,WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,WuLiaoImagePath,ShowMark,CreateUser,CreateDate
    FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY wlinfo.CreateDate DESC ) AS RowID,
    wlinfo.ID,wltype.WuLiaoTypeName AS WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,WuLiaoImagePath,wlinfo.ShowMark,wlinfo.CreateUser,wlinfo.CreateDate
    FROM MK_Info_WuLiao wlinfo JOIN dbo.MK_Type_WuLiao wltype ON wltype.ID = wlinfo.WuLiaoTypeID
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    order by t.RowID

    SELECT TOP 1 rows FROM sys.partitions WHERE Object_name(object_id) = 'MK_Info_WuLiao'
  </sql>
  
  <sql name="QueryTypeWuLiao">
    SELECT TOP (@limit)
    ID,WuLiaoTypeName,ShowMark,CreateUser,CreateDate
    FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY CreateDate DESC ) AS RowID,* FROM MK_Type_WuLiao
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    order by t.RowID

    SELECT TOP 1 rows FROM sys.partitions WHERE Object_name(object_id) = 'MK_Type_WuLiao'
  </sql>
  
  <sql name="QueryInfoSupplier">
    SELECT TOP (@limit)
    ID,SupplierName,LianXiRen,LianXiFangShi,Address,ShowMark,CreateUser,CreateDate,t.WuLiaoDetail
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY a.CreateDate DESC ) AS RowID,a.*,(
            SELECT '['+twl.WuLiaoTypeName+']'
            FROM dbo.MK_Info_Supplier_WuLiao swl
            JOIN dbo.MK_Type_WuLiao twl ON twl.ID = swl.ShangPinID
            WHERE swl.SupplierID = a.ID
            FOR XML PATH('')
        ) AS WuLiaoDetail
        FROM dbo.MK_Info_Supplier a
        LEFT JOIN dbo.MK_Info_Supplier_WuLiao b ON b.SupplierID = a.ID
        GROUP BY a.ID,SupplierName, [LianXiRen], [LianXiFangShi], [Address], a.[ShowMark], a.[CreateUser], a.[CreateDate]
    ) as t
    WHERE t.RowID > (@limit*(@page-1))
    order by t.RowID

    SELECT TOP 1 rows FROM sys.partitions WHERE Object_name(object_id) = 'MK_Info_Supplier'
  </sql>

  <sql name="CheckInfoWuLiaoEXISTS">
    SELECT COUNT(ID) FROM dbo.MK_Info_WuLiao WHERE ShangPinName = @ShangPinName AND GuiGe = @GuiGe
  </sql>

  <sql name="InsertInfoWuLiao">
    INSERT MK_Info_WuLiao
    (WuLiaoTypeID,ShangPinName,GuiGe,HaiGuanNo,CreateUser,CreateDate)
    VALUES
    (@WuLiaoTypeID,@ShangPinName,@GuiGe,@HaiGuanNo,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertTypeWuLiao">
    INSERT MK_Type_WuLiao (WuLiaoTypeName,CreateUser,CreateDate) VALUES (@WuLiaoTypeName,@CreateUser,@CreateDate)
  </sql>
  
  <sql name="InsertInfoSupplier">
    INSERT MK_Info_Supplier 
    (ID,SupplierName,LianXiRen,LianXiFangShi,Address,CreateUser,CreateDate) 
    VALUES
    (@ID,@SupplierName,@LianXiRen,@LianXiFangShi,@Address,@CreateUser,@CreateDate)
  </sql>

  <sql name="UpdateInfoWuLiao">
    UPDATE MK_Info_WuLiao
    SET SupplierName = @SupplierName,LianXiRen=@LianXiRen,LianXiFangShi=@LianXiFangShi,Address=@Address,
    CreateUser=@CreateUser,CreateDate=@CreateDate
    WHERE ID = @ID
  </sql>

  <sql name="UpdateTypeWuLiao">
    UPDATE MK_Type_WuLiao SET WuLiaoTypeName = @WuLiaoTypeName WHERE ID = @ID
  </sql>
  
  <sql name="UpdateInfoSupplier">
    UPDATE MK_Info_Supplier
    SET SupplierName = @SupplierName,LianXiRen = @LianXiRen,LianXiFangShi = @LianXiFangShi,Address = @Address
    WHERE ID = @ID

    DELETE FROM MK_Info_Supplier_WuLiao WHERE SupplierID=@ID
  </sql>

  <sql name="DeleteInfoWuLiao">
    DELETE FROM MK_Info_WuLiao WHERE ID = @ID
  </sql>

  <sql name="DeleteTypeWuLiao">
    DELETE FROM MK_Type_WuLiao WHERE ID = @ID
  </sql>
  
  <sql name="DeleteInfoSupplier">
    DELETE FROM MK_Info_Supplier WHERE ID=@ID
    DELETE FROM MK_Info_Supplier_WuLiao WHERE SupplierID=@ID
  </sql>

  <sql name="GetWuLiaoTypeID">
    SELECT WuLiaoTypeID FROM MK_Info_WuLiao WHERE ID = @ID
  </sql>

  <sql name="GetShangPinBySupplier">
    SELECT ShangPinID FROM MK_Info_Supplier_WuLiao WHERE SupplierID = @SupplierID
  </sql>
</DataDictionary>